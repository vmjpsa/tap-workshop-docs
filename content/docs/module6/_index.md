---
weight: 6
title: "ソフトウェアサプライチェーン"
---

## ソフトウェアサプライチェーン

先ほどLive Update でアプリケーションをデプロイしましたが、先述したようにコードを書いてURL として公開される、いわゆるSource to URL の世界のその間に実際に多くのプロセスが含まれます。それを確認してみましょう。

TAP GUI にアクセスします。別タブで開いていない場合は下記コマンドでURL を確認できますので再度アクセスしてください。

```shell
echo $TAP_GUI_URL
```

アクセスしたら、下記画像のように、左ペインの十字のようなアイコンをクリックします。nohe-hello-tanzu という項目がありますのでそれをクリックします。なお、他の参加者のアプリケーションもここでは見えるため、node-hello-tanzu が沢山あるかもしれませんが、どれを選択しても構いません。

{{< figure src="supply-chain-access.png" width="100%">}}

ここで、アプリケーションがどのようなプロセスを経てURL として公開されたかが分かります。

{{< figure src="supply-chain.png" width="100%">}}

## サプライチェーンとは？

サプライチェーンは確認できましたか？今回はsource-to-url というTAP 組み込みの最もシンプルなサプライチェーンを使ってデプロイされています。このサプライチェーンは、その名の通りソースコードを入力として、最終的にURL として公開しているのですが、間にいくつかステップがあります。例えばImage Builder ではソースコードからTanzu Build Service を使ってコンテナイメージを作成するステップになります。Config Provider はConvention Services と呼ばれる仕組みで、サプライチェーンの中で推奨設定値をマニフェストに埋め込むことができます。App Config ステップでは、Knativeサービング、サービスバインディング、リソースクレーム、Kubernetes のConfigmap を作成します。Config Writer ステップでは追加の設定ファイルをイメージのレポジトリやgit リポジトリに作成します。Pull Config は設定値の取得、そして最後にDelivery ステップで作成したアプリケーションがKubernetes 上にknative オブジェクトとして展開され、URL としてアクセスできるようになります。

一般的なCI/CD パイプラインとの違いは何でしょうか？

サプライチェーンは、CI/CD パイプラインを含む、より一般的な単語です。つまり、ソフトウェアがユーザーに届けられるまでの一連の流れを表現したもので、[Cartographer](https://cartographer.sh/) というTAP の中核的なコンポーネントで実現されます。TAP では、Cartographer を用いて、Tekton などのCI/CD パイプラインを実現するソフトウェアをさらに抽象化しています。抽象化といえばサーバー仮想化も一つの抽象化ですが、ここでの抽象化の大きなメリットは複雑化しているCI/CD にシンプルさを提供することです。DevSecOps を実現するには、開発者やインフラ担当、セキュリティ担当など、様々な役割を持った人が相互に連携しなければなりません。既存のCI/CD パイプラインでは、線形にタスクを連結し、ある種のオレオレパイプラインが出来上がり、結果属人化やメンテナンスコストの問題が発生する可能性があります。

Catographer では、サプライチェーン作成時にインプットとアウトプットに注目します。つまり、何を受け取り、何を出力するのかさえ正しく記述していれば、そのステップ（Cartographer ではテンプレートと呼びます）で何が起ころうとも気にしません。GUI 上でステップ間に小さな四角とその中の文字列があったかと思いますが、あれがまさにインプットでありアウトプットです。例えば、最初のSource Provicer ステップの出力はtar.gz に固めたソースファイルのURL とリビジョン、およびそれぞれのダイジェスト値ですし、Image Builder のインプットもそれらになります。サプライチェーンを作成する側からしてみれば考慮事項が減るため、よりシンプルに役割分担ができると言えます。

{{< figure src="supply-chain-image.png" width="100%">}}

また、抽象化の大きな恩恵でもある柔軟性のメリットもあります。複数のアプリケーションにまたがるサプライチェーンの再利用や、コードのコミット（セキュリティ スキャン、CVE パッチ適用、OS パッチ適用など）に依存しないトリガの柔軟性が向上します。

他にもサプライチェーンを利用するメリットは多々ありますが、詳細は[https://blogs.vmware.com/vmware-japan/2022/09/beyond_ci_cd.html](https://blogs.vmware.com/vmware-japan/2022/09/beyond_ci_cd.html)をご参照ください。

重要な点として、サプライチェーンはCI/CD パイプラインを補完するものであり、対立するものでは決してありません。既存のCI/CD パイプラインが、もし運用性や属人化等の課題を抱えているのであれば、Catographer やTAP が支援できるかもしれません。

さて、TAP の場合は組み込みの典型的なサプライチェーンがいくつか用意されています。もう少しTAP の機能を深堀りしてみるために、別のサプライチェーンを使ってアプリケーションをデプロイしてみましょう。

次に進む前に、デプロイしたnode-hello-tanzu アプリケーションを削除します。

```shell
tanzu apps workload delete node-hello-tanzu -y
```

```
coder@code-server-696f98d647-vx77m:~/node-hello-tanzu$ tanzu apps workload delete node-hello-tanzu -y
Deleted workload "node-hello-tanzu"
```
